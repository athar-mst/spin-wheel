<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wheel of Fortune</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: #f5f5f5;
    margin: 0;
    padding: 20px;
  }
  canvas {
    margin-top: 40px;
    cursor: pointer;
    transition: transform 3s ease-out;
  }
  .popup {
    display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.6); justify-content: center; align-items: center;
  }
  .popup-content {
    background: white; padding: 20px 30px; border-radius: 10px; text-align: center;
  }
  .btn {
    display: inline-block; background: #0074d9; color: white; padding: 10px 20px;
    border-radius: 5px; text-decoration: none; margin-top: 10px;
  }
</style>
</head>
<body>
<h2>ðŸŽ¡ Tap to Spin & Win!</h2>
<canvas id="wheel" width="300" height="300"></canvas>

<div class="popup" id="popup">
  <div class="popup-content">
    <h3 id="message"></h3>
    <a href="https://www.carrefouregypt.com/mafegy/en" target="_blank" class="btn">Shop Now</a>
  </div>
</div>

<script>
const prizes = ["50 EGP", "70 EGP", "100 EGP", "120 EGP", "Better Luck", "Better Luck"];
const colors = ["#FFD700", "#FF5733", "#00BFFF", "#32CD32", "#B0B0B0", "#FF69B4"];
const shuffled = prizes.sort(() => Math.random() - 0.5);

const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const radius = canvas.width / 2;
const arc = (2 * Math.PI) / shuffled.length;

let rotation = 0;
let spinning = false;

// Draw wheel function
function drawWheel(angleOffset = 0) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (let i = 0; i < shuffled.length; i++) {
    const start = i * arc + angleOffset;
    const end = start + arc;
    ctx.beginPath();
    ctx.fillStyle = colors[i];
    ctx.moveTo(radius, radius);
    ctx.arc(radius, radius, radius, start, end);
    ctx.fill();

    ctx.save();
    ctx.translate(radius, radius);
    ctx.rotate(start + arc / 2);
    ctx.fillStyle = "#000";
    ctx.font = "14px Arial";
    ctx.textAlign = "right";
    ctx.fillText(shuffled[i], radius - 10, 5);
    ctx.restore();
  }
}

// Initial draw
drawWheel();

// Spin animation
canvas.addEventListener("click", () => {
  if (spinning) return; // prevent multiple clicks
  spinning = true;

  // Random spin: 3 to 6 full rotations + random stopping angle
  const spinAngle = (Math.random() * 2 * Math.PI) + (Math.PI * 2 * (3 + Math.floor(Math.random() * 3)));
  const duration = 4000;
  const start = performance.now();

  function animate(time) {
    const elapsed = time - start;
    const progress = Math.min(elapsed / duration, 1);
    const easeOut = 1 - Math.pow(1 - progress, 3);
    rotation = easeOut * spinAngle;
    drawWheel(rotation);
    if (progress < 1) {
      requestAnimationFrame(animate);
    } else {
      spinning = false;
      showResult();
    }
  }
  requestAnimationFrame(animate);
});

// Determine result
function showResult() {
  const normalized = rotation % (2 * Math.PI);
  const index = Math.floor(((2 * Math.PI) - normalized) / arc) % shuffled.length;
  const result = shuffled[index];

  const popup = document.getElementById("popup");
  const msg = document.getElementById("message");
  if (result.includes("EGP")) {
    msg.textContent = `ðŸŽ‰ Congratulations! You won ${result}!`;
  } else {
    msg.textContent = "ðŸ˜… Better luck next time!";
  }
  popup.style.display = "flex";
}

document.getElementById("popup").addEventListener("click", () => {
  document.getElementById("popup").style.display = "none";
});
</script>
</body>
</html>
